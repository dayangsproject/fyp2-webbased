<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/sidebar.css" />
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="menu_content"> 
            <ul class="menu_items">
                <i id="sidebarOpen"></i>
                <li class="item no-click">
                    <a class="nav_link">
                        <span class="navlink_icon">
                            <i class='bx bx-menu'></i>
                        </span>
                        <h3>Menu</h3>
                    </a>
                </li>
                <li class="item">
                    <a href="#" class="nav_link">
                        <span class="navlink_icon">
                            <i class='bx bxs-dashboard'></i>
                        </span>
                        <span class="navlink">Dashboard</span>
                    </a>
                </li>
                <li class="item">
                    <div class="nav_link submenu_item">
                        <span class="navlink_icon">
                            <i class='bx bxs-user-circle'></i>
                        </span>
                        <span class="navlink">Profile</span>
                        <i class="bx bx-chevron-right arrow-left"></i>
                    </div>
                    <ul class="menu_items submenu">
                        <li><a href="aa-profile.html" class="nav_link sublink">Edit profile</a></li>
                        <li><a href="aa-password.html" class="nav_link sublink">Change password</a></li>
                    </ul>
                </li>
                <li class="item">
                    <div class="nav_link submenu_item">
                        <span class="navlink_icon">
                            <i class='bx bxs-spreadsheet'></i>
                        </span>
                        <span class="navlink">Student</span>
                        <i class="bx bx-chevron-right arrow-left"></i>
                    </div>
                    <ul class="menu_items submenu">
                        <li><a href="aa-addstudent.html" class="nav_link sublink">Add new student</a></li>
                        <li><a href="aa-student-list.html" class="nav_link sublink">Student list</a></li>
                        <li><a href="aa-studentcourse.html" class="nav_link sublink">Student course</a></li>
                    </ul>
                </li>
                <li class="item">
                    <div class="nav_link submenu_item">
                        <span class="navlink_icon">
                            <i class='bx bxs-food-menu'></i>
                        </span>
                        <span class="navlink">Course</span>
                        <i class="bx bx-chevron-right arrow-left"></i>
                    </div>
                    <ul class="menu_items submenu">
                        <li><a href="aa-viewcourse.html" class="nav_link sublink">View course list</a></li>
                        <li><a href="aa-addcourse.html" class="nav_link sublink">Add course</a></li>
                        <li><a href="aa-editcourse.html" class="nav_link sublink">Edit course</a></li>
                    </ul>
                </li>
                <li class="item">
                    <a href="aa-report.html" class="nav_link">
                        <span class="navlink_icon">
                            <i class='bx bxs-report'></i>
                        </span>
                        <span class="navlink">Report</span>
                    </a>
                </li>
                <li class="item">
                    <a href="#" class="nav_link" id="signOutButton">
                        <span class="navlink_icon">
                            <i class='bx bx-exit'></i>
                        </span>
                        <span class="navlink">Log Out</span>
                    </a>
                </li>
                <li class="item">
                    <a href="#" class="nav_link">
                        <span class="navlink_icon">
                            <i id="darkLight"></i>
                        </span>
                        <span class="navlink"></span>
                    </a>
                </li>
            </ul>
            <!-- Sidebar Open / Close -->
            <div class="bottom_content">
                <div class="bottom expand_sidebar">
                    <span> Expand</span>
                    <i class='bx bx-expand-horizontal'></i>
                </div>
                <div class="bottom collapse_sidebar">
                    <span> Collapse</span>
                    <i class='bx bx-collapse-horizontal'></i>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="container mt-5">
        <h1 class="mb-4">List of students</h1>
        <br>
        <input type="text" id="searchInput" class="form-control mb-2" placeholder="Search...">
        <br>
        <table class="table table-light">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Matric No</th>
                    <th>Name</th>
                    <th>Intake</th>
                    <th>Mode</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="tbody1"></tbody>
        </table>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Edit Student Details</h5>
                </div>
                <div class="modal-body">
                    <!-- Input fields for editing student details will go here -->
                    <label for="matricNo">Matric No:</label>
                    <input type="text" id="matricNo" class="form-control mb-2">

                    <label for="name">Name:</label>
                    <input type="text" id="name" class="form-control mb-2">

                    <label for="intake">Intake:</label>
                    <input type="text" id="intake" class="form-control mb-2">

                    <label for="phoneNumber">Phone Number:</label>
                    <input type="text" id="phoneNumber" class="form-control mb-2">

                    <label>Mode</label>
                    <select id="mode" class="form-control">
                        <option value=""></option>
                        <option value="febFull">February Full Time</option>
                        <option value="juneFull">June Full Time</option>
                        <option value="octFull">October Full Time</option>
                        <option value="febPart">February Part Time</option>
                        <option value="junePart">June Part Time</option>
                        <option value="octPart">October Part Time</option>
                    </select>

                    <label>Status</label>
                    <select id="status" class="form-control">
                        <option value=""></option>
                        <option value="Active">Active</option>
                        <option value="Graduate">Graduate</option>
                        <option value="On hiatus">On hiatus</option>
                        <option value="Withdrawn">Withdrawn</option>
                        <option value="Failed and quit">Failed and quit</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button id="saveChangesBtn" type="button" class="btn btn-primary">Save changes</button>
                    <button id="closeModalBtn" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getDatabase, ref, get, set, child, update, remove } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
    
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBYET4H_QA7j0QggLxjh-KQcX_O0h_YAao",
            authDomain: "test-99503.firebaseapp.com",
            databaseURL: "https://test-99503-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "test-99503",
            storageBucket: "test-99503.appspot.com",
            messagingSenderId: "1017306171186",
            appId: "1:1017306171186:web:851d2a7cde6f1a26b8792b"
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
    
        // Get a reference to the Firebase database
        const db = getDatabase();
    
        // Function to add buttons to each row of the table
        function addButtonsToTable(matricNo, studentName, admission, mode, status, phoneNumber) {
            // Create the container for buttons
            const buttonContainer = document.createElement("div");
    
            // Create the "View/Edit" button
            const viewButton = document.createElement("button");
            viewButton.textContent = "View/Edit";
            viewButton.classList.add("btn", "btn-primary", "mr-2");
            viewButton.addEventListener("click", function() {
                // Populate the modal input fields with student details
                document.getElementById("matricNo").value = matricNo;
                document.getElementById("name").value = studentName;
                document.getElementById("intake").value = admission;
                document.getElementById("phoneNumber").value = phoneNumber;
                document.getElementById("mode").value = mode;
                document.getElementById("status").value = status;
                // Show the modal
                showModal();
            });
    
            // Create the "Delete" button
            const deleteButton = document.createElement("button");
            deleteButton.textContent = "Delete";
            deleteButton.classList.add("btn", "btn-danger");
            deleteButton.addEventListener("click", function() {
                if (confirm(`Are you sure you want to delete student with Matric No: ${matricNo}?`)) {
                    deleteStudent(matricNo);
                }
            });
    
            // Append buttons to the container
            buttonContainer.appendChild(viewButton);
            buttonContainer.appendChild(deleteButton);
    
            // Create a new cell in the row and append the button container
            const td = document.createElement("td");
            td.appendChild(buttonContainer);
    
            return td;
        }
    
        // Function to add a row to the table
        function addRowToTable(studentNo, matricNo, studentName, admission, mode, status, phoneNumber) {
            const tbody = document.getElementById('tbody1');
            const tr = document.createElement("tr");
    
            // Add cells to the row
            const cells = [
                studentNo,
                matricNo,
                studentName,
                admission,
                mode,
                status
            ];
    
            // Append cells to the row
            cells.forEach(cell => {
                const td = document.createElement("td");
                td.textContent = cell;
                tr.appendChild(td);
            });
    
            // Create and append the button cell
            const buttonTd = document.createElement("td");
            buttonTd.appendChild(addButtonsToTable(matricNo, studentName, admission, mode, status, phoneNumber));
            tr.appendChild(buttonTd);
    
            // Append the row to the table body
            tbody.appendChild(tr);
        }
    
        function getAllDataOnce() {
            const dbRef = ref(db);
    
            get(child(dbRef, "StudentInfo")).then((snapshot) => {
                const students = [];
                snapshot.forEach((childSnapshot) => {
                    const matricNo = childSnapshot.key; // Get the matric number from the key
                    const studentData = childSnapshot.val(); // Retrieve other data
                    const { studentName, admission, mode, status, phoneNumber } = studentData;
                    students.push({ matricNo, studentName, admission, mode, status, phoneNumber });
                });
    
                // Add each student's data to the table
                students.forEach((student, index) => {
                    addRowToTable(index + 1, student.matricNo, student.studentName, student.admission, student.mode, student.status, student.phoneNumber);
                });
            });
        }
    
        // Function to show the modal
        function showModal() {
            $('#exampleModalCenter').modal('show');
        }
    
        // Function to close the modal
        function closeModal() {
            $('#exampleModalCenter').modal('hide');
        }
    
        // Function to delete a student from the database
        function deleteStudent(matricNo) {
            const studentRef = ref(db, `StudentInfo/${matricNo}`);
            remove(studentRef)
                .then(() => {
                    alert('Student deleted successfully!');
                    location.reload();
                })
                .catch((error) => {
                    console.error("Error deleting student: ", error);
                });
        }
    
        // Function to handle search
        function handleSearch() {
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#tbody1 tr');
    
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                let found = false;
    
                cells.forEach(cell => {
                    if (cell.textContent.toLowerCase().includes(searchQuery)) {
                        found = true;
                    }
                });
                if (found) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Function to sign out user
        function signOut() {
            sessionStorage.removeItem("user-creds");
            sessionStorage.removeItem("user-info");
            window.location.href = 'index.html';
        }

        // Event listener to sign out user
        const signOutButton = document.getElementById('signOutButton');
        signOutButton.addEventListener('click', signOut);

        // Attach event listener to search input
        document.getElementById('searchInput').addEventListener('input', handleSearch);

        // Call the function to fill the table when the window loads
        window.onload = getAllDataOnce;
    </script>
    <script src="js/sidebar.js"></script>
</body>
</html>
