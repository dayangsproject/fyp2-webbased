<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/sidebar.css" />
    <link rel="stylesheet" href="css/styles-2.css" /> 
</head>
<body>

    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="menu_content"> 
            <ul class="menu_items">
                <i id="sidebarOpen"></i>
                <li class="item no-click">
                    <a class="nav_link">
                        <span class="navlink_icon">
                            <i class='bx bx-menu'></i>
                        </span>
                        <h3>Menu</h3>
                    </a>
                </li>
                <li class="item">
                    <a href="aa-home.html" class="nav_link">
                        <span class="navlink_icon">
                            <i class='bx bxs-dashboard'></i>
                        </span>
                        <span class="navlink">Dashboard</span>
                    </a>
                </li>
                <li class="item">
                    <div class="nav_link submenu_item">
                        <span class="navlink_icon">
                            <i class='bx bxs-user-circle'></i>
                        </span>
                        <span class="navlink">Profile</span>
                        <i class="bx bx-chevron-right arrow-left"></i>
                    </div>
                    <ul class="menu_items submenu">
                        <li><a href="aa-profile.html" class="nav_link sublink">Edit profile</a></li>
                        <li><a href="aa-password.html" class="nav_link sublink">Change password</a></li>
                    </ul>
                </li>
                <li class="item">
                    <div class="nav_link submenu_item">
                        <span class="navlink_icon">
                            <i class='bx bxs-spreadsheet'></i>
                        </span>
                        <span class="navlink">Student</span>
                        <i class="bx bx-chevron-right arrow-left"></i>
                    </div>
                    <ul class="menu_items submenu">
                        <li><a href="aa-addstudent.html" class="nav_link sublink">Add new student</a></li>
                        <li><a href="aa-student-list.html" class="nav_link sublink">Student list</a></li>
                        <li><a href="aa-studentcourse.html" class="nav_link sublink">Student course</a></li>
                    </ul>
                </li>
                <li class="item">
                    <div class="nav_link submenu_item">
                        <span class="navlink_icon">
                            <i class='bx bxs-food-menu'></i>
                        </span>
                        <span class="navlink">Course</span>
                        <i class="bx bx-chevron-right arrow-left"></i>
                    </div>
                    <ul class="menu_items submenu">
                        <li><a href="aa-viewcourse.html" class="nav_link sublink">View course list</a></li>
                        <li><a href="aa-addcourse.html" class="nav_link sublink">Add course</a></li>
                        <li><a href="aa-editcourse.html" class="nav_link sublink">Edit course</a></li>
                    </ul>
                </li>
                <li class="item">
                    <a href="aa-report.html" class="nav_link">
                        <span class="navlink_icon">
                            <i class='bx bxs-report'></i>
                        </span>
                        <span class="navlink">Report</span>
                    </a>
                </li>
                <li class="item">
                    <a href="#" class="nav_link" id="signOutButton">
                        <span class="navlink_icon">
                            <i class='bx bx-exit'></i>
                        </span>
                        <span class="navlink">Log Out</span>
                    </a>
                </li>
                <li class="item">
                    <a href="#" class="nav_link">
                        <span class="navlink_icon">
                            <i id="darkLight"></i>
                        </span>
                        <span class="navlink"></span>
                    </a>
                </li>
            </ul>
            <!-- Sidebar Open / Close -->
            <div class="bottom_content">
                <div class="bottom expand_sidebar">
                    <span> Expand</span>
                    <i class='bx bx-expand-horizontal'></i>
                </div>
                <div class="bottom collapse_sidebar">
                    <span> Collapse</span>
                    <i class='bx bx-collapse-horizontal'></i>
                </div>
            </div>
        </div>
    </nav>

    <div id="mainContent" class="row mb-4">
        <h3 id="greet"></h3><br>
    </div>

    <!-- Content Row -->
    <div class="container">

        <div class="row mb-4">
            <!-- Content 1 -->
            <div class="col-md-6 mb-4">
                <div class="card border-left-primary shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                    Total Admins</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalAdmins">Loading...</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-users fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content 2 -->
            <div class="col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                    Total Students</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalStudents">Loading...</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-user-graduate fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pie Charts Row -->
        <div class="row mb-4">
            <!-- Pie Chart 1 -->
            <div class="col-xl-6 col-lg-6">
                <div class="card shadow mb-4">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">Full Time Intake</h6>
                    </div>
                    <div class="card-body">
                        <div class="chart-pie pt-4 pb-2">
                            <canvas id="myPieChart1"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pie Chart 2 -->
            <div class="col-xl-6 col-lg-6">
                <div class="card shadow mb-4">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">Part Time Intake</h6>
                    </div>
                    <div class="card-body">
                        <div class="chart-pie pt-4 pb-2">
                            <canvas id="myPieChart2"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Row for Course Content -->
        <div class="row mb-4">
            <!-- Total Courses -->
            <div class="col-md-4 mb-4">
                <div class="card border-left-info shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Total Courses</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalCourses">Loading...</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Courses -->
            <div class="col-md-4 mb-4">
                <div class="card border-left-warning shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                    Active Courses</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="activeCoursesCount">Loading...</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-comments fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inactive Courses -->
            <div class="col-md-4 mb-4">
                <div class="card border-left-primary shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                    Inactive Courses</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="inactiveCoursesCount">Loading...</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-calendar fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
    
        const firebaseConfig = {
                apiKey: "AIzaSyBYET4H_QA7j0QggLxjh-KQcX_O0h_YAao",
                authDomain: "test-99503.firebaseapp.com",
                databaseURL: "https://test-99503-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "test-99503",
                storageBucket: "test-99503.appspot.com",
                messagingSenderId: "1017306171186",
                appId: "1:1017306171186:web:851d2a7cde6f1a26b8792b",
                databaseURL: "https://test-99503-default-rtdb.asia-southeast1.firebasedatabase.app"
        };
    
        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
    
        let userCreds = JSON.parse(sessionStorage.getItem("user-creds"));
        let userInfo = JSON.parse(sessionStorage.getItem("user-info"));
    
        let GreetHead = document.getElementById('greet');
        GreetHead.innerText = `Hello ${userInfo.name}`;
    
        let CheckCred = () => {
            if (!sessionStorage.getItem("user-creds")) {
                window.location.href = 'index.html';
            } else {
                displayUserInfoPopup(userCreds.email, userInfo.name);
                fetchTotalAdmins();
                fetchTotalStudents();
                fetchStudentModes();
                fetchCourseStatusCounts();
                fetchTotalCourses();
            }
        };
    
        window.addEventListener('load', CheckCred);
    
        function displayUserInfoPopup(email, name) {
            alert(`User with email "${email}" logged in.\nWelcome ${name}.`);
        }
    
        function fetchTotalAdmins() {
            const adminsRef = ref(db, 'AdminInfo');
            get(adminsRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const totalAdmins = Object.keys(snapshot.val()).length;
                    document.getElementById('totalAdmins').innerText = totalAdmins;
                } else {
                    document.getElementById('totalAdmins').innerText = '0';
                }
            }).catch((error) => {
                console.error('Error fetching admins: ', error);
            });
        }
    
        function fetchTotalStudents() {
            const studentsRef = ref(db, 'StudentInfo');
            get(studentsRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const totalStudents = Object.keys(snapshot.val()).length;
                    document.getElementById('totalStudents').innerText = totalStudents;
                } else {
                    document.getElementById('totalStudents').innerText = '0';
                }
            }).catch((error) => {
                console.error('Error fetching students: ', error);
            });
        }
    
        function fetchStudentModes() {
            const studentsRef = ref(db, 'StudentInfo');
            get(studentsRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const students = snapshot.val();
                    let fulltimeFebruary = 0,
                        fulltimeJune = 0,
                        fulltimeOctober = 0,
                        parttimeFebruary = 0,
                        parttimeJune = 0,
                        parttimeOctober = 0;
    
                    Object.values(students).forEach((student) => {
                        const mode = student.mode;
                        if (mode === "febFull") {
                            fulltimeFebruary++;
                        } else if (mode === "juneFull") {
                            fulltimeJune++;
                        } else if (mode === "octFull") {
                            fulltimeOctober++;
                        } else if (mode === "febPart") {
                            parttimeFebruary++;
                        } else if (mode === "junePart") {
                            parttimeJune++;
                        } else if (mode === "octPart") {
                            parttimeOctober++;
                        }
                    });
    
                    // Update Pie Chart 1
                    var ctx1 = document.getElementById("myPieChart1").getContext('2d');
                    var myPieChart1 = new Chart(ctx1, {
                        type: 'pie',
                        data: {
                            labels: ["February", "June", "October"],
                            datasets: [{
                                data: [fulltimeFebruary, fulltimeJune, fulltimeOctober],
                                backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc'],
                                hoverBackgroundColor: ['#2e59d9', '#17a673', '#2c9faf'],
                                hoverBorderColor: "rgba(234, 236, 244, 1)",
                            }],
                        },
                        options: {
                            maintainAspectRatio: false,
                            tooltips: {
                                backgroundColor: "rgb(255,255,255)",
                                bodyFontColor: "#858796",
                                borderColor: '#dddfeb',
                                borderWidth: 1,
                                xPadding: 15,
                                yPadding: 15,
                                displayColors: false,
                                caretPadding: 10,
                            },
                            legend: {
                                display: false
                            },
                            cutoutPercentage: 80,
                        },
                    });
    
                    // Update Pie Chart 2
                    var ctx2 = document.getElementById("myPieChart2").getContext('2d');
                    var myPieChart2 = new Chart(ctx2, {
                        type: 'pie',
                        data: {
                            labels: ["February", "June", "October"],
                            datasets: [{
                                data: [parttimeFebruary, parttimeJune, parttimeOctober],
                                backgroundColor: ['#ff6384', '#36a2eb', '#ffcd56'],
                                hoverBackgroundColor: ['#ff4384', '#36a2db', '#ffcd36'],
                                hoverBorderColor: "rgba(234, 236, 244, 1)",
                            }],
                        },
                        options: {
                            maintainAspectRatio: false,
                            tooltips: {
                                backgroundColor: "rgb(255,255,255)",
                                bodyFontColor: "#858796",
                                borderColor: '#dddfeb',
                                borderWidth: 1,
                                xPadding: 15,
                                yPadding: 15,
                                displayColors: false,
                                caretPadding: 10,
                            },
                            legend: {
                                display: false
                            },
                            cutoutPercentage: 80,
                        },
                    });
    
                } else {
                    console.error('No students found');
                }
            }).catch((error) => {
                console.error('Error fetching students: ', error);
            });
        }
    
        function fetchCourseStatusCounts() {
            const coursesRef = ref(db, 'CourseInfo');
            get(coursesRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const courses = snapshot.val();
                    let activeCount = 0;
                    let inactiveCount = 0;
    
                    Object.values(courses).forEach((course) => {
                        if (course.courseStatus === "Active") {
                            activeCount++;
                        } else {
                            inactiveCount++;
                        }
                    });
    
                    document.getElementById('activeCoursesCount').innerText = activeCount;
                    document.getElementById('inactiveCoursesCount').innerText = inactiveCount;
    
                } else {
                    console.error('No courses found');
                }
            }).catch((error) => {
                console.error('Error fetching courses: ', error);
            });
        }
    
        // Function to sign out user
        function signOut() {
            sessionStorage.removeItem("user-creds");
            sessionStorage.removeItem("user-info");
            window.location.href = 'index.html';
        }

        // Event listener to sign out user
        const signOutButton = document.getElementById('signOutButton');
        signOutButton.addEventListener('click', signOut);

        function fetchTotalCourses() {
            const coursesRef = ref(db, 'CourseInfo');
            get(coursesRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const totalCourses = Object.keys(snapshot.val()).length;
                    document.getElementById('totalCourses').innerText = totalCourses;
                } else {
                    document.getElementById('totalCourses').innerText = '0';
                }
            }).catch((error) => {
                console.error('Error fetching courses: ', error);
            });
        }
    </script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Sidebar -->
    <script src="js/sidebar.js"></script>
</body>
</html>
